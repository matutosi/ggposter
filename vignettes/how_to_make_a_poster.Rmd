---
title: "how_to_make_a_poster"
author: "Toshikazu, Matsumura"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{how_to_make_a_poster}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Setup

Attach essential packages for setup. 
Please install them if not yet. 

```{r setup}
library(tidyverse)
library(grid)
library(gridExtra)
library(ggposter)
```

# Overview

## Design policy of ggposter

ggposter supports making a poster and slides for academic conferences. 
The design policy of ggposter is to create small grobs and then attach them together like building blocks to complete a poster or slides. 
This may not bring a smart solution and is likely to be inferior to other ways in terms of speed. 
Nevertheless, ggposter makes easy to create a poster.
We can also use parts of a poster for other slides and other presentation parts, and vice versa. 

In ggposter, the sizes of the globs are fixed to a simple unit such as "mm". 
Therefore, it may not be possible to use original forms of code as it is. 
However, it can be possible to reused with a little effort.

## Comparison with other packages

Some R packages related to grid and ggplot2 can arrange the plots and grobs. 
gridExtra, patchwork, and cowplot are well designed packages for arrangement. 
These packages, however, are not designed for arrangement of strings (text), 
thus few people may make a poster and slides by these packages. 

In gridExtra, we should decide the layout of parts in a poster before making. 
In most cases, the layout of a poster will be decided and changed while making, at least for me. 
In ggposter we do not need to decide the complete layout before making, 
because the layout in ggposter will be adjusted with the size (width and height) of grobs. 

In patchwork and cowplot also do not need to decided the layout. 
The size of plot will be resized to fit the hole width or height of viewport, which is an advantage for making document. 
But, it is desirable in the point of appearance for making a poster to unify the size of plot, figure, and font size of body text.

# Functions and settings in ggposter

## Poster size

Most of posters in academic conferences can be based on A0 size paper. 
When we prepare it, however, A4 size is comfortable and printable. 
Argument `shrink` in ggposter decide how much it will be shrunk. 
`shrink`=0.25 make poster just size for A4 paper. 

We can use `full` and `half` for paper width as grid unit, which are defined by `grid::unit()`. 
In addition, space defined by `grid::unit()` between grob are set here. 
We can change it. 

```{r poster_size}
size <- "A0"
size <- "A4" # for preparation
if(size=="A0") i <- 1 else 
if(size=="A4") i <- 2

full <- grid::unit(c(841, 210), "mm")[i]
half <- grid::unit(c(420, 105), "mm")[i]
shrink <- c(1, 0.25)[i]
space <- grid::unit(2, "mm")
```

## Font size

In ggposter, as a series of font size `font_size_list` is already set, 
which include `base_size`, `ratio`, `font_name` `font_use`, `size`. 
If we do not specify `base_size`, 26 pt will be used.
We can select 8, 10, 12, 14, 18, 22, 26, 32, and 38 pt as a `base_size`. 
I recommend users to use 22, 26 or 32 pt for a poster in a general use. 
`font_use` express size to easily understand in a use of poster. 
Name of `font_name` is like LaTeX from scriptsize to Huge, and HUGE that is originally added. 
As described above, we can choose to specify `base_size` or to omit it. 
`font_use` or `font_name` are given as string name. 
Then the font `size` used exactly in a poster will be selected automatically. 

The way by which font sizes are selected is as follows. 
If a text name is `txt_ITEM_05` and `txt_body_02`, 
the font size for ITEM (larger than item) and body (smaller than BODY) sentence will be selected. 
Examples will be shown bellow and in "Example: ggposter". 

We can see font size as plot by ggplot2 visualization as below. 

```{r font_size}
data(font_size_list)
dplyr::filter(font_size_list, base_size==26)
dplyr::filter(font_size_list, ratio==1)
font_size_list %>%
  ggplot2::ggplot(ggplot2::aes(x=base_size, y=size)) + 
  ggplot2::geom_point() + 
  ggplot2::theme_bw()
```

If we can change values of `size`, `base_size`, and others by overwriting `font_size_list`. ???
The data contained in ggposter was generated by the code as below. 
<!-- 
Is this TRUE ???
TODO: 
  - `font_size_list` should be speciefied as an argument in `arrange_txt()` and `get_font_size()`.    
-->

```{r}
base  <- c(8, 10, 12, 14, 18, 22, 26, 32, 38)
ratio <- round(c(1/(1.2^(4:1)), 1.2^(0:6)), 2)
name  <- c(
       "tiny",         "scriptsize", "footnotesize", "small",   
       "normalize",   "large",      "Large",        "LARGE",     
       "huge",         "Huge",       "HUGE"
        )
use   <- c(
       "tiny",         "script",     "footnote",     "caption", 
       "body",         "BODY",       "item",         "ITEM|thank",
       "author|affil", "subt|kw",    "title"
       )
font_size_list <- 
  tibble::tibble(
    base_size=rep(base,   each=length(ratio)), 
    ratio=rep(ratio,      times=length(base)), 
    font_name=rep(name,   times=length(base)), 
    font_use=rep(use,     times=length(base))) %>%
  dplyr::mutate(size=round(base_size * ratio, 0))
  # # For making package
  # usethis::use_data(font_size_list, font_size_list)
```

## Combine grobs: `appose_grobs()` and `stack_grobs()`

We can combine grobs with appose_grobs() and stack_grobs(). 
These functions generate a layout of grob arrangement and place grobs. 
In this process, widths and heights of the grobs will be converted into abstract unit ("mm"), and keep them. 

<!-- 
  while appose_image_grobs() and stack_image_grobs() can change the size. 


TODO: 
  Aggregate the functions bellow into one or two.
   - appose_grobs()   
   - appose_grobs_conv()   
   - appose_image_grobs()   
   - stack_grobs()   
   - stack_grobs_conv()   
   - stack_image_grobs()   

   - argument   
    -- orientation: "vertical" or "horizontal"   
    -- resize, fill, unify: "height", "width", "as_is"   
-->


Argument `space` is vertical (`appose_grobs_conv()`) or horizontal (`stack_grobs_conv()`) space between grobs. 
`gp` (grid::gpar()) and `name` (a string) can be also given. 

```{r appose_grobs, fig.width=8.3, out.width="100%"}
small <- grid::rectGrob(width=grid::unit(10, "mm"), height=grid::unit(10, "mm"), gp=grid::gpar(fill="black"))
tall  <- grid::rectGrob(width=grid::unit(10, "mm"), height=grid::unit(20, "mm"), gp=grid::gpar(fill="red"))
wide  <- grid::rectGrob(width=grid::unit(20, "mm"), height=grid::unit(10, "mm"), gp=grid::gpar(fill="blue"))
large <- grid::rectGrob(width=grid::unit(20, "mm"), height=grid::unit(20, "mm"), gp=grid::gpar(fill="white"))
apposed <- combine_image_grobs(small, tall, wide, large, 
                    direction = "horizontal", unify = "as_is", space = grid::unit(2, "mm"))
stacked <- combine_image_grobs(small, tall, wide, large, 
                    direction = "vertical", unify = "as_is", space = grid::unit(2, "mm"))

grid::grid.show.layout(apposed$frame$layout)  # show layout
grid::grid.draw(apposed)

grid::grid.newpage()
combined <- 
  combine_image_grobs(apposed, stacked, direction = "horizontal", unify = "as_is", space=unit(2, "mm"))
grid::grid.draw(combined)
```

## Arrange text: `arrange_txt()`

When you want arranged text grob, you can use `arrange_txt()`, 
which generate the combined grob including text grobs. 
Font sizes of text grobs will be selected according to the variable name, as shown bellow. 

NOTE: 
To make easier to identify each letter, argument `shrink=0.5` is set in the code bellow. 
For preparation, argument `shrink` multiply the font size. 
When `shrink=1` is the same size for A0 paper, `shrink=0.25` makes the size for A4 paper. 

```{r font_size_example, fig.width=8.3, out.width="100%", fig.height=3.5}
txt_title    <- "This is a title."
txt_subt     <- "subt is for subtitle and keyword. "
txt_author   <- "author is for author and affiliation. "
txt_ITEM     <- "ITEM text is larger than item text."
txt_item     <- "This is a item text too, but smaller than ITEM."
txt_BODY     <- "BODY text is larger than body text."
txt_body     <- "This is a body text too, but smaller than BODY."
txt_caption  <- "caption is more smaller. "
txt_footnote <- "This is footnote. "
txt_script   <- "This is script. "
txt_tiny     <- "This is tiny. "
txt_body_add <- "The size is decreasing (increasing) roughly every 1.2 times."

font_size_example <- 
  arrange_txt(
    txt_title, txt_subt, txt_author, 
    txt_ITEM, txt_item, txt_BODY, txt_body, 
    txt_caption, txt_footnote, txt_script, txt_tiny,
    txt_body_add, 
    widths=full, shrink=0.5)
grid::grid.draw(font_size_example)
```

## Wrapped text: `split_text_grob()`

We can make some ways to create a wrapped text grob, 
such as `splitTextGrob()`, `split_text_grob()`, `gridtext::richtext_grob()`, and `gridtext::textbox_grob()`. 

`splitTextGrob()` is based on 
["R Graphics" (1st edition) by Paul Murell]( https://www.stat.Auckland.ac.nz/~paul/RGraphics/rgraphics.html ), 
which can change the width of text according to the viewport. 

```{r, fig.width=8.3, out.width="100%", fig.height=2}
t_1 <- "This is a sample text. "
t_2 <- "When longer than viewport width, "
t_3 <- "text will be split and add a break. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
stg <- splitTextGrob(text)
vp_050 <- viewport(width=grid::unit(50, "mm"))
vp_100 <- viewport(width=grid::unit(100, "mm"))
pushViewport(vp_050)
grid::grid.draw(stg)
grid::grid.newpage()
pushViewport(vp_100)
grid::grid.draw(stg)
```

`splitTextGrob()` is very usefull when the width of viewport is not fixed. 
This advantage can be disadvantage when we want fixed size grob like making a poster. 
`split_text_grob()` is slightly modified based on `splitTextGrob()`, 
which generate wrapped text grob with fixed text width. 

```{r, fig.width=8.3, out.width="100%", fig.height=2}
s_t_g <- split_text_grob(text, width=grid::unit(80, "mm"))
grid::grid.draw(s_t_g)
```


`richtext_grob()` and `textbox_grob()` provided by gridtext package, 
which can provide sophisticated formatting by handling basic markdown and HTML. 

```{r richtext_grob}
rtg <- gridtext::richtext_grob(text)
tbg <- gridtext::textbox_grob(text)
grid::grid.draw(rtg)
grid::grid.newpage()
grid::grid.draw(rtg)
```


## Combine image grobs

As is in the case with combining strings above, we can combine images. 
Images with different widths or heights can be unified into the same width, height, or using the original ratio. 
Four types of images exist in ggposter package. 
We can import the images by function `system.file()` and `jpeg::readJPEG()` and convert them into grobs by `grid::rasterGrob()`

Then we can combine image grobs using `appose_image_grobs()`. 
List of image grobs given to the function will be expanded into including image grobs. 
We can combine multiple and various types of image grobs, 
such as jpg and png given as arguments. 

Argument width or height specifies the hole size of a combined grob as return value. 
Argument `unify="height"` means that the height of each image grob will be unified, `unify="width" means will be unified width. 
Aspect ratio of the image grobs keep in original.

We can stack images and combined images like string grobs. 
The difference between `unify="height"` and `unify="width"` can be seen as below. 
As combined strings, space between grobs can be specified. 

```{r jpgs, fig.width=8.3, out.width="100%"}
jpg_grobs <- 
  stringr::str_c("original_", c("small", "tall", "wide", "large"), ".jpg") %>%
  system.file("extdata", ., package="ggposter") %>%
  purrr::map(jpeg::readJPEG) %>%
  purrr::map(grid::rasterGrob)

fix_width_height <- combine_image_grobs(jpg_grobs, direction = "horizontal", width=half, unify="height", space=space)
fix_width_width  <- combine_image_grobs(jpg_grobs, direction = "horizontal", width=half, unify="width",  space=space)
  # Can specify multiple image grobs (not a list of grobs) as shown below
  # appose_image_grobs(jpg_grob_1, jpg_grob_2, png_grob_1, width=half)
stacked_image_grob <- 
  combine_image_grobs(fix_width_height, fix_width_width, direction = "vertical", width=half, unify="width",space=space)

grid.draw(stacked_image_grob)
```

Of course, we can combine any grobs such as texts and images. 
The usage of the function was already described. 

```{r strings_and_images, fig.width=8.3, out.width="100%", fig.height=4.1}
  # description
txt_ITEM_40  <- "COMBINE IMAGES<br>"
txt_BODY_41   <- "- appose_image_grobs() and stack_image_grobs().<br>"
txt_BODY_42   <- "- Import images and arrange them in a line (row or col).<br>"
txt_BODY_43   <- "- Unify height or width of images (argument: unify).<br>"
txt_BODY_44   <- "- Fix hole width and/or height of combined grob (argument: width, height).<br>"
txt_BODY_45   <- "- gridtext::textbox_grob() will wrap strings (insert line breaks) longer than specified widht automatically."
txt <- str_c(txt_ITEM_40, txt_BODY_41, txt_BODY_42, txt_BODY_43, txt_BODY_44, txt_BODY_45)
image_description <- gridtext::textbox_grob(txt, width=half, use_markdown=FALSE)
image_and_description <- stack_grobs_conv(image_description, stacked_image_grob, space=space)
grid.draw(image_and_description)
  # convertUnit(grobHeight(image_and_description), "in")
```

<!--
TODO:
 - Add description text for each image over or under it and according the horizontal position for it.   
 - Usign `stack_image_grob()` make a solution???   

-->


## Use table

<!--
https://github.com/baptiste/gridExtra/blob/master/R/tableGrob.r
-->

When we want make a table like booktab in LaTeX or in a academic journal, 
Function `booktab_table_grob()` generate a booktab like table grob in a step. 


```{r fig.width=8.3, out.width="100%", fig.height=4}
grid::grid.newpage()
head(iris) %>%
  booktab_table_grob(title="title words", caption="caption words", fontsize=20, shrink=0.5) %>%
  grid::grid.draw()
```

```{r fig.width=8.3, out.width="100%", fig.height=4}
font_size_table <- 
  font_size_list %>%
  dplyr::filter(base_size==26) %>%
  booktab_table_grob(title="Font size of ggposter", fontsize=20, shrink=0.5)
base_size_table <- 
  font_size_list %>%
  dplyr::filter(ratio==1) %>%
  booktab_table_grob(title="Base font size of ggposter", caption="Font size increases every 1.2 times approximately.", fontsize=20, shrink=0.5)

grid::grid.draw(combine_image_grobs(font_size_table, base_size_table, direction="horizontal", unify="as_is", space=grid::unit(10, "mm")))
```

All `booktab_table_grob()` does is call `gridExtra::tableGrob()`, `add_booktab()`, and `add_annotation()`. 
We can change appearance of table grob by customizing gridExtra::tableGrob(). 
See in detail at [Displaying tables as grid graphics]
( https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html ) by Baptiste Auguie. 


```{r example_table, fig.width=8.3, out.width="100%", fig.height=4}
grid::grid.newpage()
head(iris) %>%
  gridExtra::tableGrob(rows=NULL, theme=gridExtra::ttheme_minimal()) %>%
  add_booktab(lwd_out=2, lwd_in=1) %>%
  add_annotation(title="title words", caption="caption words") %>%
  grid::grid.draw()
```


## With ggplot2 
  # (and cowplot)

```{r ggplot2}

library(grid)
 # fig
text <- 
  "abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc abc"

space=grid::unit(1, "mm"); widths=grid::unit(rep(50, 2), "mm")

fig <- 
  ggplot2::ggplot(mpg, aes(x=displ, y=hwy)) + 
  geom_point() + 
  theme_bw()
fontsize <- 8
shrink <- 1

grid::grid.draw(appose_fig_text(fig, text, fontsize=26, shrink=0.5))


   # title
title <- "Colab with ggplot2 and gridtext"
fontsize <- 60
gp_title <- grid::gpar(fontsize=fontsize)
 # text
txt_body_31 <- "As shown in this example, we can use ggplot object in ggposter. "
txt_body_32 <- "We can write description aroud it."
description <- stringr::str_c(txt_body_31, txt_body_32)
fontsize <- 30
lineheight <- 1.1
gp_text <- grid::gpar(fontsize=fontsize, lineheight=lineheight)
 # generate slide and draw
slide <- gen_slide(title, fig, description, gp_title, gp_text, width=half)
grid.newpage()
grid::grid.draw(slide)

description_1 <- 
  arrange_txt(
    txt_body_31, txt_body_32, 
    widths=half)
grid.newpage()
grid.draw(combine_image_grobs(ggplot2::ggplotGrob(fig), description_1, direction="horizontal", unify="width"))
```


## With gridtext


```{r gridtext}

```



# Example: ggposter

As an example, this vignette shows how to make a poster. 

## Title

A string name "txt_title" means that the font size of this string (value) will be selected for title. 
Data `font_size_list` include various range of base size and relative font size (see "font size" part).
We change base of font size, then a series of font size will be changed. 

The first part of string name ( "txt" in "txt_title" ) is arbitrary, 
and second part decides font size. 
We can add third part like "txt_ITEM_10", which is arbitrary as well (see "Objectives" and "Conclusions" part). 
This part is simply used to avoid duplication in string name. 

```{r title}
txt_title  <- "How to Make a Poster with ggposter Package in R"
txt_subt   <- "For comfortable and tidy work"
txt_kw     <- "Key words: ggplot2, grid, gridtext, R"
txt_author <- "Toshikazu Matsumura, matutosi@gmail.com"
txt_affil <- "Konan Women's Univ., Japan"
```

We can combine strings into an arranged grob.
Arguments `x=0.5` and `y=0.5` indicate that the position of each string in each viewport will be centered, 
while argument hjust specify the horizontal adjustment of the each string. 
`width=full` means grob width will be 210 mm in this case (cf. "Poster size"), 
and `shrink=0.25` make the font size as 0.25 times as the original size. 
We can draw a generated grob by `grid.draw`, as shown bellow. 

```{r arrange_text, fig.width=8.3, out.width="100%"}
title <- arrange_txt(
    txt_title, txt_subt, txt_kw, txt_author, txt_affil,
    x=0.5, y=0.5, hjust=c(rep(0.5, 3), rep(0, 2)), widths=full, shrink=0.25)
grid::grid.draw(title)
```

## Objectives

Like title and other string, we can combine some items and sentences, as shown bellow. 

```{r objectives}
txt_ITEM_10  <- "OBJECTIVES"
txt_BODY_11   <- "- Want to use R throughout making a poster."
txt_BODY_12   <- "- To use grid and ggplot2 system."
txt_BODY_13   <- "- Not to make similar poster from scratch."

txt_ITEM_20  <- "BACKGROUNDS"
txt_BODY_21   <- "- No R packages or tools for making a poster."
txt_BODY_22  <- "- PowerPoint needs many manual procedures to uniform a style."
txt_BODY_23  <- "- If we can make a poster with R, no need to save and load plots."

objectives <- arrange_txt(
  txt_ITEM_10, 
  txt_BODY_11, txt_BODY_12, txt_BODY_13, 
  widths=half, shrink=0.25)

backgrounds <- arrange_txt(
  txt_ITEM_20, 
  txt_BODY_21, txt_BODY_22, txt_BODY_23, 
  widths=half, shrink=0.25)
```

## Conclusions

This is a simple sample, too. 

```{r conclusions}
txt_ITEM_30  <- "CONCLUSIONS"
txt_BODY_31   <- "- Please install from CRAN or GitHub."
txt_BODY_32   <- "- ggposter package can might be a alternative tool for making a poster and slides."
txt_BODY_33   <- "- Colaboration with ggplot2, gridtext or other package may produce more effects."
txt_BODY_34   <- "- Still in the development stage and can have bugs."
txt_BODY_35   <- "- Welcome your requests."
txt_BODY_36   <- "- ENJOY!"

conclusions <- arrange_txt(
  txt_ITEM_30, 
  txt_BODY_31, txt_BODY_32, txt_BODY_33, txt_BODY_34, txt_BODY_35, txt_BODY_36, 
  widths=half, shrink=0.25)
```

## Combine text 

Arranged text grob generated by `arrange_txt()` can be apposed and/or stacked by `stack_grobs_conv()` and `appose_grobs_conv()`. 

Objectives and backgrounds are stacked, and then apposed besides `conclusions`. 
At Last, title will be stacked above objectives and backgrounds. 
We can draw combined grob (part_1). 
In this case, the paper size is A4, so you can check small manuscript on a paper or your pc screen. 

```{r combine_part_1, fig.width=8.3, out.width="100%"}
grid::grid.newpage()
part_1 <- 
  combine_image_grobs(title, 
    combine_image_grobs(
      combine_image_grobs(objectives, backgrounds, direction = "vertical", unify="as_is", space=space),
      conclusions, direction = "horizontal", unify="as_is", space=space), 
  direction = "vertical", unify="as_is", space=space)
grid.draw(part_1)
```


## Combine fig and table


```{r fig_font_size, fig.width=8.3, out.width="100%"}
fig_font_size <- 
  font_size_list %>%
  ggplot2::ggplot(ggplot2::aes(x=base_size, y=size)) + 
    ggplot2::geom_point() + 
    ggplot2::theme_bw()


fig_font_size_grob <-
  fig_font_size %>%
  ggplotGrob() %>%
  fix_size(width=grid::unit(80, "mm"), shrink=shrink * 26 / 12)

grid.draw(fig_font_size_grob)



fig_description <- 
"
- ggposter include a series of font size.<br>
- Base font size for a poster is 22, 26 or 32 pt.<br>
- Font `size` used exactly in a poster will be selected automatically.<br>
  - eg. text name: txt_ITEM_05 font size for ITEM.<br>
- We can change font size according to preference.<br>
" %>%
  gridtext::textbox_grob(width=0.5*half, use_markdown=FALSE)

fig_apposed <- combine_image_grobs(fig_font_size_grob, fig_description, direction="horizontal", unify="as_is")
grid::grid.draw(fig_apposed)

```





```{r table_iris, fig.width=8.3, out.width="100%"}
table_iris <- 
  head(iris) %>%
  gridExtra::tableGrob(rows=NULL, theme=gridExtra::ttheme_minimal())  %>%
  add_booktab(lwd_out=2, lwd_in=1) %>%
  grid::grid.draw()
table_description <- ""

```



## Rendering a poster

```{r rendering_and_save}
grid.newpage()


  # ggplot2::ggsave("d:/tmp.pdf", poster)
  # ggplot2::ggsave("d:/tmp.png", poster)
```

# Make a Slide


```{r slide}
library(grid)

fig <- 
  ggplot2::ggplot(mpg, aes(x=displ, y=hwy)) + 
  geom_point() +
  theme_bw()

  # text
t_1 <- "This is a sample text. "
t_2 <- "When longer than width, "
t_3 <- "text will be split and add breaks. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # gp_text
fontsize <- 20
lineheight <- 1.1
gp_text <- gpar(fontsize=fontsize, lineheight=lineheight)

  # title
title_1 <- "THIS IS TITLE WORDS"
  # gp_text
fontsize <- 40
gp_title <- gpar(fontsize=fontsize)

slide <- gen_slide(title_1, fig, text, gp_title, gp_text)
grid.draw(slide)
  # ggplot2::ggsave("d:/slide.pdf", slide, height=210, width=297, units="mm")

```



# Inside ggposter

ggposter is designed for making a poster and rendering speed is slow, 
because the 

## Combine ggobject and text grob 

We can combine ggplot object and text grob using gridExtra package. 

At first, generate ggplot object as below. 

```{r gg_obj, warning=FALSE}
gg_obj <- 
  ggplot2::ggplot(mpg) + 
  ggplot2::geom_point(aes(x = displ, y = hwy)) +
  ggplot2::theme_bw()
gg_obj  # draw ggplot object
```


```{r text}

  # tb <- txt2tibble(txt_body_1, txt_body_2, txt_body_3)
  # tb <- 
  # dplyr::mutate(font_size = purrr::pmap_dbl(tb, get_font_size)) %>%
  # dplyr::mutate(just="left") %>%
  # purrr::pmap(as_tg)
  # layout <- tg2layout(tg)
  # ar_tg <- tg_arrange(tg=tg, layout=layout)
```

Then, generate text grob as below. 
```{r text_grob2, warning=FALSE}
txt_body_1 <- "This graphics was generated using ggplot2. "
txt_body_2 <- "x axis is displ that means engine displacement in litres."
txt_body_3 <- "y axis is hwy that means highway miles per gallon."

tg_grob <- arrange_txt(txt_body_1, txt_body_2, txt_body_3)
grid::grid.draw(tg_grob)
grid::grid.newpage
```

Next, combine
```{r combine_gg_text, warning=FALSE}
gg_and_text <- gridExtra::grid.arrange(gg_obj, tg_grob, nrow=1, respect=c(TRUE, FALSE), widths=c(1,2))
grid::grid.draw(gg_and_text)
```

<!--
http://www.sthda.com/english/wiki/wiki.php?id_contents=7930
-->


## Table grob

We can make a table grob using `tableGrob()` in gridExtra, and draw it. 

```{r make_table, fig.width=8.3, out.width="100%", fig.height=4}
font_size_table <- 
  font_size_list %>%
  dplyr::filter(base_size==26) %>%
  gridExtra::tableGrob(rows=NULL)

base_size_table <- 
  font_size_list %>%
  dplyr::filter(ratio==1) %>%
  gridExtra::tableGrob(rows=NULL)

grid::grid.draw(font_size_table)
```

Since the widths and heights given by these function might not be correct, 
thus the apposed or stacked table grob will be overwrapped. 
I can not exactly identify the code that causes this, I can not suggest fundamental solution to it. 
<!-- maybe bug of the function `row_heighst()` and `col_widths`.  -->


```{r apposed_table, fig.width=8.3, out.width="100%", fig.height=4}
convertUnit(grobWidth(font_size_table), "mm")  # wrong unit
convertUnit(grobWidth(base_size_table), "mm")  # wrong unit
apposed <- combine_image_grobs(font_size_table, base_size_table, direction="horizontal", unify="as_is", space=space)
grid::grid.draw(apposed)
```

Using `fix_table_unit` make it possible to arrange table grobs at correct position. 
This function fix width and height of a table grob, 
so I recommend users not to use under other situations because of a table grob returned does not fit resized viewpot. 

```{r fixed_apposed_table, fig.width=8.3, out.width="100%", fig.height=4}
font_size_table <- fix_table_unit(font_size_table)
base_size_table <- fix_table_unit(base_size_table)
convertUnit(grobWidth(font_size_table), "mm")  # correct unit
convertUnit(grobWidth(base_size_table), "mm")  # correct unit

apposed_fixed <- combine_image_grobs(font_size_table, base_size_table, direction="horizontal", unify="as_is", space=space)
grid::grid.draw(apposed_fixed)
```

<!--
  - https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html   
  - https://gedevan-aleksizde.github.io/rmarkdown-cookbook/kableextra.html   
  - https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html   
-->


# References

- Code in "R graphic" by Paul Murell
  - [1st edition]( https://www.stat.Auckland.ac.nz/~paul/RGraphics/rgraphics.html )
  - [2nd edition]( https://www.stat.Auckland.ac.nz/~paul/RG2e/ )
  - [3rd edition]( https://www.stat.Auckland.ac.nz/~paul/RG3e/ )


<!--
  - https://stat-ata-asu.github.io/R_DS_BD2020/using-ggplot2.html
  - https://www.christophenicault.com/post/understand_size_dimension_ggplot2/

  - ggplot2, grid, gtable, gridExtra
    - https://notchained.hatenablog.com/entry/2015/12/17/010904
    - https://github.com/baptiste/gridExtra/wiki/arranging-ggplot

  - gtable
    - https://cran.r-project.org/web/packages/gridExtra/vignettes/gtable.html
    - https://github.com/r-lib/gtable
-->



<!--
# No need


## rectGrob test



  # ggplot2::ggsave("d:/tmp.png", tmp)
  # ggplot2::ggsave("d:/tmp.pdf", tmp)
  
rlogo <- 
    system.file("extdata", "Rlogo.png", package = "gridtext") %>%
  png::readPNG() %>%
  grid::rasterGrob()
grid::grid.draw(combine_image_grobs(rlogo, rlogo, rlogo, direction = "horizontal", space=grid::unit(1, "mm"), unify="as_is"))

rlogo$width <- grid::unit(20, "mm")
grid::grid.draw(combine_image_grobs(rlogo, rlogo, rlogo, direction = "horizontal", space=grid::unit(1, "mm"), unify="as_is"))



## grid.ftable
To modify grid.ftable() function
but it does not work well.
because grobHeight() and grobWidth() become 0 mm !!

  library(grid)
  library(tidyverse)
  grid.ftable2 <- function(d, padding=grid::unit(2, "mm"), width=NULL, height=NULL, rownames=FALSE, name=NULL, gp=NULL, ...) {
    nc <- if(rownames) ncol(d) + 1 else ncol(d)
    nr <- nrow(d)
      # character table with added row and column names
    rnames <- if(rownames) c("", rownames(d)) else NULL
    extended_matrix <- cbind(rnames, rbind(colnames(d), as.matrix(d)))
      # string width and height
    w <- apply(extended_matrix, 2, graphics::strwidth,  "inch")
    h <- apply(extended_matrix, 2, graphics::strheight, "inch")
    widths  <- apply(w, 2, max)
    heights <- apply(h, 1, max)
    padding <- grid::convertUnit(padding, unitTo="in", valueOnly=TRUE)
    x <- cumsum(widths + padding) - 0.5 * padding
    y <- cumsum(heights + padding) - padding
    rg <- grid::rectGrob(x = grid::unit(x - widths/2, "in"),
                         y = grid::unit(1, "npc") - grid::unit(rep(y, each = nc), "in"),
                         width = grid::unit(widths + padding, "in"),
                         height = grid::unit(heights + padding, "in"))
    tg <- grid::textGrob(c(t(extended_matrix)), x = grid::unit(x - widths/2, "in"),
                         y = grid::unit(1, "npc") - grid::unit(rep(y, each = nc), "in"),
                         just = "center")
    if(is.null(width))  width  <- grid::unit(sum(widths),  "inch")
    if(is.null(height)) height <- grid::unit(sum(heights), "inch")
    vp <- viewport(x=0.5, y=0.5, width=width, height=height)
    g <- grid::gTree(..., children = grid::gList(rg, tg), vp=vp)
    grid::grid.draw(g)
    invisible(g)
  }

  grid::grid.newpage()
  t1 <- 
    font_size_list %>%
    dplyr::filter(base_size==26) %>%
    grid.ftable2(padding=grid::unit(2, "mm"))

  grid.draw(t1)

  t2 <- combine_image_grobs(t1, t1, direction="horizontal", unify="as_is")
  grid::grid.show.layout(t2$frame$layout)
  grid::grid.draw(t2)

  convertUnit(grobHeight(t1), "mm")
  convertUnit(grobHeight(t2), "mm")
  convertUnit(grobWidth(t1), "mm")
  convertUnit(grobWidth(t2), "mm")


-->
<!--

-->
<!-- -->
