---
title: "how_to_make_a_poster"
author: "Toshikazu, Matsumura"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{how_to_make_a_poster}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Setup

Atatch essential packages for setup. 
Please install them if not yet. 

```{r setup}
library(tidyverse)
library(grid)
library(ggposter)
```

# Example: ggposter

As an example, this vignette shows how to make a poster. 

## Poster size

Most of posters in academic conferences can be based on A0 size paper. 
When we prepare it, however, A4 size is comfotable and printable. 
Argument `shrink` in ggposter decide how much it will be shrunk. 
`shrink`=0.25 make poster just size for A4 paper. 

You can use `full` and `half` for paper width as grid unit, which are defined by `grid::unit()`. 
In addition, space defined by `grid::unit()` among grob are set here. 
You can change it as you want. 

```{r poster_size}
size <- "A0"
size <- "A4" # for preparation
if(size=="A0") i <- 1 else 
if(size=="A4") i <- 2

full <- grid::unit(c(841, 210), "mm")[i]
half <- grid::unit(c(420, 105), "mm")[i]
shrink <- c(1, 0.25)[i]
space <- grid::unit(2, "mm")
```

## Title

A string name "txt_title" means that the font size of this string (value) will be selected for title. 
Data `font_size_list` include various range of base size and relative font size (see "font size" part).
You change base of font size, then a series of font size will be changed. 

The first part of string name ( "txt" in "txt_title" ) is arbitrary, 
and second part is important because it decide font size. 
You can add third part like "txt_ITEM_10", which is arbitrary as well (see "Objectives" and "Conclusions" part). 
It is simply used to avoid dupulication in string name. 

```{r title}
txt_title  <- "How to Make a Poster with ggposter Package in R"
txt_subt   <- "For comfotable and tidy work"
txt_kw     <- "Key words: ggplot2, grid, gridtext, R"
txt_author <- "Toshikazu Matsumura, matutosi@gmail.com"
txt_affil <- "Konan Women's Univ., Japan"
```

You can combine strings into an arranged grob.
Arguments `x=0.5` and `y=0.5` indicate that the position of each string in each viewport will be centered, 
while argument hjust specify the holizontal ajustment of the each string. 
`width=full` means grob width will be 210 mm in this case (cf. "Poster size"), 
and `shrink=0.25` make the font size as 0.25 times as the original size. 
You can draw a generated grob by `grid.draw`, as shown bellow. 

```{r arrange_text, fig.width=8.3, out.width="100%"}
title <- arrange_txt(
    txt_title, txt_subt, txt_kw, txt_author, txt_affil,
    x=0.5, y=0.5, hjust=c(rep(0.5, 3), rep(0, 2)), widths=full, shrink=0.25)
grid::grid.draw(title)
```

## Objectives

Like title and other string, you can combine some items and sentences, as shown bellow. 

```{r objectives}
txt_ITEM_10  <- "OBJECTIVES"
txt_BODY_11   <- "- Want to use R throughout making a poster."
txt_BODY_12   <- "- To use grid and ggplot2 system."
txt_BODY_13   <- "- Not to make similar poster from scratch."

txt_ITEM_20  <- "BACKGROUNDS"
txt_BODY_21   <- "- No R packages or tools for making a poster."
txt_BODY_22  <- "- PowerPoint needs many manual procedures to uniform a style."
txt_BODY_23  <- "- If we can make a poster with R, no need to save and load plots."

objectives <- arrange_txt(
  txt_ITEM_10, 
  txt_BODY_11, txt_BODY_12, txt_BODY_13, 
  widths=half, shrink=0.25)

backgrounds <- arrange_txt(
  txt_ITEM_20, 
  txt_BODY_21, txt_BODY_22, txt_BODY_23, 
  widths=half, shrink=0.25)
```

## Conclusions

This is a simple sample, too. 

```{r conclusions}
txt_ITEM_30  <- "CONCLUSIONS"
txt_BODY_31   <- "- Please install from CRAN or GitHub."
txt_BODY_32   <- "- ggposter package can might be a alternative tool for making a poster and slides."
txt_BODY_33   <- "- Colaboration with ggplot2, gridtext or other package may produce more effects."
txt_BODY_34   <- "- Still in the development stage and can have bugs."
txt_BODY_35   <- "- Welcome your requests."
txt_BODY_36   <- "- ENJOY!"

conclusions <- arrange_txt(
  txt_ITEM_30, 
  txt_BODY_31, txt_BODY_32, txt_BODY_33, txt_BODY_34, txt_BODY_35, txt_BODY_36, 
  widths=half, shrink=0.25)
```

## Combine string grobs

Arranged text grob generated by `arrange_txt()` can be apposed and/or stacked by `stack_grobs_conv()` and `appose_grobs_conv()`. 
In this case, Argument `space` 
objectives and backgrounds are stacked in a stacked, and then stacked grob are apposed besides `conclusions`. 
Argument `space` is vertical (`appose_grobs_conv()`) or horizontal (`stack_grobs_conv()`) space of grob. 
At Last, title will be stacked above Objectives and backgrounds on the 

You can draw combined grob (part_1). 
In this case, the paper size is A4, so you can check printed small manuscript. 

```{r combine_part_1, fig.width=8.3, out.width="100%"}
part_1 <- 
  stack_grobs_conv(title, 
    appose_grobs_conv(
      stack_grob(objectives, backgrounds, space=space),
      conclusions), space=space)
grid.draw(part_1)
```

## Combine image grobs

As is in the case with combining strings shown above, you can combine images. 
Images with different widths or heights can be unified into the same width or height as well as using the original ratio. 
Four types of images exist in ggposter package. 
You can import the images by function `system.file()` and `jpeg::readJPEG()` and convert them into grobs by `grid::rasterGrob()`

Then you can combine image grobs using `appose_image_grobs()`. 
Image grobs of list given to the function will be expanded into including image grobs. 
You can multiple number and various types of image grobs such as jpg and png can be given as arguments. 

Argument width or height species the hole size of a combined grob as return value. 
Argument `unify="height"` means that the height of each image grob will be unified, `unify="width" means will be unified width. 
Aspect ratio of the image grobs keep in original.

You can stack images and combined images like string grobs. 
The difference between `unify="height"` and `unify="width"` can be seen as below. 
As combined strings, space amang grobs can be specified. 

```{r jpgs, fig.width=8.3, out.width="100%"}
jpg_grobs <- 
  stringr::str_c("original_", c("small", "tall", "wide", "large"), ".jpg") %>%
  system.file("extdata", ., package="ggposter") %>%
  purrr::map(jpeg::readJPEG) %>%
  purrr::map(grid::rasterGrob)
fix_width_height <- appose_image_grobs(jpg_grobs, width=half, unify="height", space=space)
fix_width_width <- appose_image_grobs(jpg_grobs,  width=half, unify="width",  space=space)
  # Can specify multiple images as shown below
  # appose_image_grobs(jpg_grob_1, jpg_grob_2, png_grob_1, width=half)
stacked_image_grob <- 
  stack_image_grobs(fix_width_height, fix_width_width, width=half, unify="width",space=space)
grid.draw(stacked_image_grob)
```

Of course, you can combine any grobs such as texts and images. 
The usage of the function was already described. 

```{r strings_and_images, fig.width=8.3, out.width="100%", fig.height=4.1}
  # description
txt_ITEM_40  <- "COMBINE IMAGES<br>"
txt_BODY_41   <- "- appose_image_grobs() and stack_image_grobs().<br>"
txt_BODY_42   <- "- Import images and arrange them in a line (row or col).<br>"
txt_BODY_43   <- "- Unify height or width of images (argument: unify).<br>"
txt_BODY_44   <- "- Fix hole width and/or height of combined grob (argument: width, height).<br>"
txt_BODY_45   <- "- gridtext::textbox_grob() will wrap strings (insert line breaks) longer than specified widht automatically."
txt <- str_c(txt_ITEM_40, txt_BODY_41, txt_BODY_42, txt_BODY_43, txt_BODY_44, txt_BODY_45)
image_description <- gridtext::textbox_grob(txt, width=half, use_markdown=FALSE)
image_and_description <- stack_grobs_conv(image_description, stacked_image_grob, space=space)
grid.draw(image_and_description)
```
convertUnit(grobHeight(image_and_description), "in")

## font size

To make table

```{r font_size}
data(font_size_list)
head(font_size_list, 5)
dplyr::filter(font_size_list, base_size==26)
dplyr::filter(font_size_list, ratio==1)
kable

library(gridExtra)
font_size_list %>%
  dplyr::filter(base_size==26) %>%
  gridExtra::grid.table(rows=NULL, theme=ttheme_minimal())

  gridExtra::tableGrob(rows=NULL)

grid.ftable(head(iris, 4), gp=gpar(fill="white"))

```

<!--
  - https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html   
  - https://gedevan-aleksizde.github.io/rmarkdown-cookbook/kableextra.html   
  - https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html   
-->

# Comparison with other packages

Some R packages related to grid and ggplot2 can arrange the plots and grobs. 
gridExtra, patchwork, and cowplot are well designed packages for arrangement. 
These packages, however, are not desined for arrangement of strings, 
thus I think few people make a poster and slides by these packages. 

In gridExtra, you should decide the layout of parts in a poster before making. 
In most cases, the layout of a poster will be decided and changed while making, at least for me. 
In ggposter you do not need to decide the layout before making, 
because the layout in ggposter will be adjusted with the size (width and height) of grobs. 

In patchwork and cowplot also do not need to decided the layout. 
The size of plot will be resized to fit the hole width and/or height of viewport, which is an advantage for making document. 
It is desirable for making a poster to unify the size of plot, figure, and font size of body text in the point of appearance.



## Colaboration with ggplot2 (and cowplot)


```{r ggplot2}
 # fig
fig <- 
  ggplot(mpg, aes(x=displ, y=hwy)) + 
  geom_point() +
  theme_bw()

   # title
title <- "Colab with ggplot2 and gridtext"
fontsize <- 60
gp_title <- grid::gpar(fontsize=fontsize)

txt_body_31 <- "As shown in this example, we can use ggplot object in ggposter. "
txt_body_32 <- "We can write description aroud it."
description <- stringr::str_c(txt_body_31, txt_body_32)

 # text
fontsize <- 30
lineheight <- 1.1
gp_text <- grid::gpar(fontsize=fontsize, lineheight=lineheight)

 # generate slide and draw
slide <- gen_slide(title, fig, description, gp_title, gp_text, width=half)

grid.newpage()
grid::grid.draw(slide)


grid.newpage()
pushViewport(vp=viewport(width=full))


description_1 <- 
  arrange_txt(
    txt_body_31, txt_body_32, 
    widths=half)

grid.newpage()
grid.draw(appose_image_grobs(ggplot2::ggplotGrob(fig), description_1, unify="width"))


```



## Colaboration with ggplot2 (and cowplot)


```{r}


```


## Colaboration with gridtext


```{r gridtext}

```


## Rendering

```{r rendering_and_save}
grid.newpage()


  # ggplot2::ggsave("d:/tmp.pdf", poster)
  # ggplot2::ggsave("d:/tmp.png", poster)
```

# Slide


```{r slide}
library(grid)
  # text
t_1 <- "This is a sample text. "
t_2 <- "When longer than width, "
t_3 <- "text will be split and add breaks. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # gp_text
fontsize <- 20
lineheight <- 1.1
gp_text <- gpar(fontsize=fontsize, lineheight=lineheight)

  # title
title_1 <- "THIS IS TITLE WORDS"
  # gp_text
fontsize <- 40
gp_title <- gpar(fontsize=fontsize)

slide <- gen_slide(title_1, fig, text, gp_title, gp_text)
grid.draw(slide)
  # ggplot2::ggsave("d:/slide.pdf", slide, height=210, width=297, units="mm")

```


# 




```{r}
  # plot
plot <- 
  ggplot2::ggplot(mpg) + 
  ggplot2::geom_point(aes(x = displ, y = hwy)) +
  ggplot2::theme_bw()
plot  # draw ggplot object

  # text
t_1 <- "This is a sample text. "
t_2 <- "When longer than width, "
t_3 <- "text will be split and add breaks. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # gp_text
fontsize <- 20
lineheight <- 1.1
gp_text <- gpar(fontsize=fontsize, lineheight=lineheight)

  # title
title <- "THIS IS TITLE WORDS"
  # gp_text
fontsize <- 40
gp_title <- gpar(fontsize=fontsize)

slide <- gen_slide(title, plot, text, gp_title, gp_text)
grid.draw(slide)
  # ggplot2::ggsave("d:/slide.pdf", slide, height=210, width=297, units="mm")

```

```{r richtext_grob}
grid::grid.newpage()
gp <- gpar(fontsize=20)
rtg <- gridtext::richtext_grob(text=text, gp=gp)
grid::grid.draw(rtg)
  # vp, gpslide

```





# test split_text_grob



```{r}
t_1 <- "This is a sample text. "
t_2 <- "When longer than viewport width, "
t_3 <- "text will be split and add a break. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
vp <- viewport(gp=gpar(fontsize=20))
pushViewport(vp)
st <- splitTextGrob(text)
grid.draw(st)

popViewport()
```

# Arrange grobs

## Text grobs

```{r text_grob, warning=FALSE}
txt_tiny     <- "tiny"
txt_script   <- "script"
txt_footnote <- "footnote"
txt_caption  <- "caption"
txt_body     <- "body"
txt_BODY     <- "BODY"
txt_item     <- "item"
txt_ITEM     <- "ITEM"
txt_thank    <- "thank"
txt_author   <- "author"
txt_affil    <- "affil"
txt_subt     <- "subt"
txt_kw       <- "kw"
txt_title    <- "title"

tg_layout_1 <- arrange_txt(txt_tiny, txt_script, txt_footnote, txt_caption, txt_body, txt_BODY, txt_item, txt_ITEM)
tg_layout_2 <- arrange_txt(txt_thank, txt_author, txt_affil, txt_subt, txt_kw, txt_title)

grid::grid.draw(tg_layout_1)
grid::grid.draw(tg_layout_2)
```


## Combine ggobject and text grob 

You can combine ggplot object and text grob using gridExtra package. 

At first, generate ggplot object as below. 

```{r gg_obj, warning=FALSE}
gg_obj <- 
  ggplot2::ggplot(mpg) + 
  ggplot2::geom_point(aes(x = displ, y = hwy)) +
  ggplot2::theme_bw()
gg_obj  # draw ggplot object
```


```{r text}

  # tb <- txt2tibble(txt_body_1, txt_body_2, txt_body_3)
  # tb <- 
  # dplyr::mutate(font_size = purrr::pmap_dbl(tb, get_font_size)) %>%
  # dplyr::mutate(just="left") %>%
  # purrr::pmap(as_tg)
  # layout <- tg2layout(tg)
  # ar_tg <- tg_arrange(tg=tg, layout=layout)
```

Then, generate text grob as below. 
```{r text_grob2, warning=FALSE}
txt_body_1 <- "This graphics was generated using ggplot2. "
txt_body_2 <- "x axis is displ that means engine displacement in litres."
txt_body_3 <- "y axis is hwy that means highway miles per gallon."

tg_grob <- arrange_txt(txt_body_1, txt_body_2, txt_body_3)
grid::grid.draw(tg_grob)
grid::grid.newpage
```

Next, combine
```{r combine_gg_text, warning=FALSE}
gg_and_text <- gridExtra::grid.arrange(gg_obj, tg_grob, nrow=1, respect=c(TRUE, FALSE), widths=c(1,2))
grid::grid.draw(gg_and_text)
```

<!--
http://www.sthda.com/english/wiki/wiki.php?id_contents=7930
-->


# Generate a poster 

## Title

```{r title_example, warning=FALSE}
txt_title_1 <- "This is a title."
txt_ITEM_1 <- "ITEM text is larger than item text."
txt_item_2 <- "This is a item text, too."
txt_BODY_1 <- "BODY text is larger than body text."
txt_body_2 <- "This is a body text, too."
arranged_txt <- arrange_txt(txt_title_1, txt_ITEM_1, txt_item_2, txt_BODY_1, txt_body_2)
grid::grid.draw(arranged_txt)
```

```{r}
  # t_1 <- "This is a sample text. "
  # t_2 <- "When longer than viewport width, "
  # t_3 <- "text will be split and add a break. "
  # t_4 <- "This text is separated into 5 objects, "
  # t_5 <- "because of R document specification."
  # text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # splitText <- split_text_grob(text)
  # grid::grid.draw(splitText)
```

# Sample


```{r sample_two_colmns, warning=FALSE}
txt_title  <- "wameicheckr"
  # txt_subt   <- ""
txt_author <- "Toshikazu Matsumura (Konan Women's univ.)"
  # txt_affil  <- ""
  # txt_thank  <- ""
txt_kw     <- "keywords: analysis，databese, search species names"
```

```{r warning=FALSE}
txt_title     <- "title"
txt_author    <- "author"
txt_kw        <- "keywords"

tg_header <- arrange_txt(txt_title, txt_author, txt_kw)
grid::grid.draw(tg_header)
```

# References

- Code in『R graphics』 by Paul Murell
  - [1st edition]( https://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html )
  - [2nd edition]( https://www.stat.auckland.ac.nz/~paul/RG2e/ )
  - [3rd edition]( https://www.stat.auckland.ac.nz/~paul/RG3e/ )


<!--
  - https://stat-ata-asu.github.io/R_DS_BD2020/using-ggplot2.html
  - https://www.christophenicault.com/post/understand_size_dimension_ggplot2/

  - ggplot2, grid, gtable, gridExtra
    - https://notchained.hatenablog.com/entry/2015/12/17/010904
    - https://github.com/baptiste/gridextra/wiki/arranging-ggplot

  - gtable
    - https://cran.r-project.org/web/packages/gridExtra/vignettes/gtable.html
    - https://github.com/r-lib/gtable
-->

# No need

```{r image}
small <- rectGrob(width=unit(1, "cm"), height=unit(1, "cm"), gp=gpar(fill="black"))
tall  <- rectGrob(width=unit(1, "cm"), height=unit(2, "cm"), gp=gpar(fill="red"))
wide  <- rectGrob(width=unit(2, "cm"), height=unit(1, "cm"), gp=gpar(fill="blue"))
large <- rectGrob(width=unit(2, "cm"), height=unit(2, "cm"), gp=gpar(fill="white"))
combined <- appose_image_grobs(small, tall, wide, large, width=grid::unit(200, "mm"), space=unit(10, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)

grid.newpage()
combined <- appose_image_grobs(small, tall, wide, large, width=grid::unit(150, "mm"), space=unit(2, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
```

```{r images}

  # ggplot2::ggsave("d:/tmp.png", tmp)
  # ggplot2::ggsave("d:/tmp.pdf", tmp)

rlogo <- 
  system.file("extdata", "Rlogo.png", package = "gridtext") %>%
  png::readPNG() %>%
  grid::rasterGrob()
grid::grid.draw(appose_image_grobs(rlogo, rlogo, rlogo, space=grid::unit(1, "mm"), unify="as_is"))

rlogo$width <- grid::unit(20, "mm")
grid::grid.draw(appose_image_grobs(rlogo, rlogo, rlogo, space=grid::unit(1, "mm"), unify="as_is"))

```
