---
title: "how_to_make_a_poster"
author: "Toshikazu, Matsumura"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{how_to_make_a_poster}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# setup

```{r setup}
library(tidyverse)
  # library(cowplot)
library(grid)
library(gridtext)
library(ggposter)
```

# Example: ggposter

## Title

```{r title}
txt_title  <- "How to Make a Poster with ggposter Package in R"
txt_subt   <- "For comfotable and tidy work"
txt_kw     <- "Key words: ggplot2, grid, gridtext, R"
txt_author <- "Toshikazu Matsumura (Konan Women's Univ., Japan), matutosi@gmail.com"

title <- arrange_txt(
    txt_title, txt_subt, txt_kw, txt_author, 
    x=0.5, y=0.5, hjust=c(rep(0.5, 3), 0), widths=grid::unit(841, "mm"))
  # grid::grid.draw(title)
```

## Objectives

```{r objectives}
txt_ITEM_10  <- "OBJECTIVES"
txt_BODY_11   <- "- Want to use R throughout making a poster."
txt_BODY_12   <- "- To use grid and ggplot2 system."
txt_BODY_13   <- "- To reuse parts of past work."
txt_ITEM_20  <- "BACKGROUND"
txt_BODY_21   <- "- No R packages or tools for making a poster."
txt_BODY_22  <- "- PowerPoint needs many manual procedures to uniform a style."
txt_BODY_23  <- "- If we can use R for making poster, no need to save and load plot files."

objectives <- arrange_txt(
  txt_ITEM_10, txt_BODY_11, txt_BODY_12, txt_BODY_13, 
  txt_ITEM_20, txt_BODY_21, txt_BODY_22, txt_BODY_23, 
  widths=grid::unit(420, "mm"))
  # grid::grid.draw(objectives)
  # objectives <- 
  #   "
  #   OBJECTIVES
  #   "
```

## Conclusions

```{r conclusions}
txt_ITEM_10  <- "CONCLUSIONS"
txt_BODY_11   <- "- Please install from CRAN or GitHub."
txt_BODY_12   <- "- ggposter package can might be a alternative tool for making a poster and slides."
txt_BODY_13   <- "- Colaboration with ggplot2, cowplot, gridtext or other package may produce more effects."
txt_BODY_14   <- "- Still in the development stage and can have bugs."
txt_BODY_15   <- "- Welcome your requests."
txt_BODY_16   <- "- ENJOY!"

conclusions <- arrange_txt(
  txt_ITEM_10, txt_BODY_11, txt_BODY_12, txt_BODY_13, txt_BODY_14, txt_BODY_15, txt_BODY_16, 
  widths=grid::unit(420, "mm"))
```


## Colaboration with ggplot2 (and cowplot)


```{r ggplot2}
fig <- 
  ggplot(mpg, aes(x=displ, y=hwy)) + 
  geom_point() +
  theme_bw()
  # fig <- ggplot2::ggplotGrob(fig)


  # text
t_1 <- "This is a sample text. "
t_2 <- "When longer than width, "
t_3 <- "text will be split and add breaks. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # gp_text
fontsize <- 20
lineheight <- 1.1
gp_text <- gpar(fontsize=fontsize, lineheight=lineheight)

  # title
title_1 <- "THIS IS TITLE WORDS"
  # gp_text
fontsize <- 40
gp_title <- gpar(fontsize=fontsize)

slide <- gen_slide(title_1, fig, text, gp_title, gp_text)
grid.draw(slide)
  # ggplot2::ggsave("d:/slide.pdf", slide, height=210, width=297, units="mm")

```

## Combine images

```{r jpgs}
library(tidyverse)
library(grid)

jpg_grobs <- 
  #   "D:/matu/work/ToDo/ggposter/inst/extdata/" %>%
  #    stringr::str_c(., "original_", c("small", "tall", "wide", "large"), ".jpg") %>%
  stringr::str_c("original_", c("small", "tall", "wide", "large"), ".jpg") %>%
  system.file("extdata", ., package="ggposter") %>%
  purrr::map(jpeg::readJPEG) %>%
  purrr::map(grid::rasterGrob)

  # fix width
grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  width=grid::unit(150, "mm"), unify="height", space=unit(10, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  width=grid::unit(100, "mm"), unify="as_is", space=unit(5, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  width=grid::unit(100, "mm"), unify="width", space=unit(1, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

  # fix length
grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  height=grid::unit(30, "mm"), unify="height", space=unit(10, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  height=grid::unit(30, "mm"), unify="as_is", space=unit(5, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  height=grid::unit(25, "mm"), unify="width", space=unit(1, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

  # fix both
grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  width=grid::unit(250, "mm"), height=grid::unit(25, "mm"), 
  unify="height", space=unit(1, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  width=grid::unit(250, "mm"), height=grid::unit(25, "mm"), 
  unify="width", space=unit(1, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid.newpage()
combined <- appose_image_grobs(jpg_grobs[[1]], jpg_grobs[[2]], jpg_grobs[[3]], jpg_grobs[[4]], 
  width=grid::unit(250, "mm"), height=grid::unit(25, "mm"), 
  unify="as_is", space=unit(1, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
sum(combined$frame$layout$widths)

grid::grid.draw(jpg_grobs[[1]])
viewport()
```


```{r image}
small <- rectGrob(width=unit(1, "cm"), height=unit(1, "cm"), gp=gpar(fill="black"))
tall  <- rectGrob(width=unit(1, "cm"), height=unit(2, "cm"), gp=gpar(fill="red"))
wide  <- rectGrob(width=unit(2, "cm"), height=unit(1, "cm"), gp=gpar(fill="blue"))
large <- rectGrob(width=unit(2, "cm"), height=unit(2, "cm"), gp=gpar(fill="white"))
combined <- appose_image_grobs(small, tall, wide, large, width=grid::unit(200, "mm"), space=unit(10, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)

grid.newpage()
combined <- appose_image_grobs(small, tall, wide, large, width=grid::unit(150, "mm"), space=unit(2, "mm"))
grid::grid.show.layout(combined$frame$layout)
grid::grid.draw(combined)
```

```{r images}
  # setwd("d:/matu/work/todo/ggposter")
  # devtools::load_all(".")

library(grid)
small <- rectGrob(width=unit(1, "cm"), height=unit(1, "cm"), gp=gpar(fill="black"))
tall  <- rectGrob(width=unit(1, "cm"), height=unit(2, "cm"), gp=gpar(fill="red"))
wide  <- rectGrob(width=unit(2, "cm"), height=unit(1, "cm"), gp=gpar(fill="blue"))
large <- rectGrob(width=unit(2, "cm"), height=unit(2, "cm"), gp=gpar(fill="white"))


grid.newpage()
grid.draw(
  appose_image_grobs(small, tall, wide, large, space=grid::unit(0, "mm"), unify="height") %8%
  appose_image_grobs(small, tall, wide, large, space=grid::unit(1, "mm"), unify="height")
  )

grid.newpage()
grid.draw(
  appose_image_grobs(small, tall, wide, large, space=grid::unit(0, "mm"), unify="as_is") %8%
  appose_image_grobs(small, tall, wide, large, space=grid::unit(1, "mm"), unify="height")
  )

grid.newpage()
grid.draw(
  appose_image_grobs(small, tall, wide, large, space=grid::unit(0, "mm"), unify="as_is") %8%
  appose_image_grobs(small, tall, wide, large, space=grid::unit(1, "mm"), unify="width")
  )


original        <- appose_image_grobs(small, tall, wide, large, space=grid::unit(0, "mm"), unify="as_is")
combined_as_is  <- appose_image_grobs(small, tall, wide, large, space=grid::unit(1, "mm"), unify="as_is")
combined_height <- appose_image_grobs(small, tall, wide, large, space=grid::unit(1, "mm"), unify="height")
combined_width  <- appose_image_grobs(small, tall, wide, large, space=grid::unit(1, "mm"), unify="width")
  # convertUnit(grobHeight(original       ), "mm")
  # convertUnit(grobHeight(combined_as_is ), "mm")
  # convertUnit(grobHeight(combined_height), "mm")
  # convertUnit(grobHeight(combined_width ), "mm")


combined <- stack_grobs(original, combined_as_is, combined_height, combined_width)
system.time(grid.draw(combined))
  # ggplot2::ggsave("d:/tmp.pdf", combined)
  # ggplot2::ggsave("d:/tmp.png", combined)

  original        %8% # original
  combined_as_is  %8%
  combined_height %8%
  combined_width 

grid.newpage()
grid.draw(
  original        %8% # original
  combined_as_is  %8%
  combined_height %8%
  combined_width 
)
tmp <- original     %8% # original
    combined_as_is  %8%
    combined_height %8%
    combined_width 
  # ggplot2::ggsave("d:/tmp.png", tmp)
  # ggplot2::ggsave("d:/tmp.pdf", tmp)

rlogo <- 
  system.file("extdata", "Rlogo.png", package = "gridtext") %>%
  png::readPNG() %>%
  grid::rasterGrob()
grid::grid.draw(appose_image_grobs(rlogo, rlogo, rlogo, space=grid::unit(1, "mm"), unify="as_is"))


rlogo$width <- grid::unit(20, "mm")
grid::grid.draw(appose_image_grobs(rlogo, rlogo, rlogo, space=grid::unit(1, "mm"), unify="as_is"))

```



## Colaboration with ggplot2 (and cowplot)


```{r}


```


## Colaboration with gridtext


```{r gridtext}

```

## Rendering

```{r rendering}
grid.newpage()
grid.draw(title %8% (objectives %oo% conclusions))

poster <- title %8% (objectives %oo% conclusions)

grid.draw(poster)
  # ggplot2::ggsave("d:/tmp.pdf", poster)
  # ggplot2::ggsave("d:/tmp.png", poster)
```


# 




```{r}
  # plot
plot <- 
  ggplot2::ggplot(mpg) + 
  ggplot2::geom_point(aes(x = displ, y = hwy)) +
  ggplot2::theme_bw()
plot  # draw ggplot object

  # text
t_1 <- "This is a sample text. "
t_2 <- "When longer than width, "
t_3 <- "text will be split and add breaks. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # gp_text
fontsize <- 20
lineheight <- 1.1
gp_text <- gpar(fontsize=fontsize, lineheight=lineheight)

  # title
title <- "THIS IS TITLE WORDS"
  # gp_text
fontsize <- 40
gp_title <- gpar(fontsize=fontsize)

slide <- gen_slide(title, plot, text, gp_title, gp_text)
grid.draw(slide)
  # ggplot2::ggsave("d:/slide.pdf", slide, height=210, width=297, units="mm")

```

```{r richtext_grob}
grid::grid.newpage()
gp <- gpar(fontsize=20)
rtg <- gridtext::richtext_grob(text=text, gp=gp)
grid::grid.draw(rtg)
  # vp, gpslide

```





# test split_text_grob



```{r}
t_1 <- "This is a sample text. "
t_2 <- "When longer than viewport width, "
t_3 <- "text will be split and add a break. "
t_4 <- "This text is separated into 5 objects, "
t_5 <- "because of R document specification."
text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
vp <- viewport(gp=gpar(fontsize=20))
pushViewport(vp)
st <- splitString(text)
grid.draw(textGrob(st, x=0, y=1, just=c("left", "top")))
  # grid.draw(textGrob(st, x=0, y=1, just=c("left", "top"), vp=vp))
popViewport()
```

# Arrange grobs

## Text grobs

```{r text_grob, warning=FALSE}
txt_tiny     <- "tiny"
txt_script   <- "script"
txt_footnote <- "footnote"
txt_caption  <- "caption"
txt_body     <- "body"
txt_BODY     <- "BODY"
txt_item     <- "item"
txt_ITEM     <- "ITEM"
txt_thank    <- "thank"
txt_author   <- "author"
txt_affil    <- "affil"
txt_subt     <- "subt"
txt_kw       <- "kw"
txt_title    <- "title"

tg_layout_1 <- arrange_txt(txt_tiny, txt_script, txt_footnote, txt_caption, txt_body, txt_BODY, txt_item, txt_ITEM)
tg_layout_2 <- arrange_txt(txt_thank, txt_author, txt_affil, txt_subt, txt_kw, txt_title)

grid::grid.draw(tg_layout_1)
grid::grid.draw(tg_layout_2)
```


## Combine ggobject and text grob 

You can combine ggplot object and text grob using gridExtra package. 

At first, generate ggplot object as below. 

```{r gg_obj, warning=FALSE}
gg_obj <- 
  ggplot2::ggplot(mpg) + 
  ggplot2::geom_point(aes(x = displ, y = hwy)) +
  ggplot2::theme_bw()
gg_obj  # draw ggplot object
```


```{r text}

  # tb <- txt2tibble(txt_body_1, txt_body_2, txt_body_3)
  # tb <- 
  # dplyr::mutate(font_size = purrr::pmap_dbl(tb, get_font_size)) %>%
  # dplyr::mutate(just="left") %>%
  # purrr::pmap(as_tg)
  # layout <- tg2layout(tg)
  # ar_tg <- tg_arrange(tg=tg, layout=layout)
```

Then, generate text grob as below. 
```{r text_grob2, warning=FALSE}
txt_body_1 <- "This graphics was generated using ggplot2. "
txt_body_2 <- "x axis is displ that means engine displacement in litres."
txt_body_3 <- "y axis is hwy that means highway miles per gallon."

tg_grob <- arrange_txt(txt_body_1, txt_body_2, txt_body_3)
grid::grid.draw(tg_grob)
grid::grid.newpage
```

Next, combine
```{r combine_gg_text, warning=FALSE}
gg_and_text <- gridExtra::grid.arrange(gg_obj, tg_grob, nrow=1, respect=c(TRUE, FALSE), widths=c(1,2))
grid::grid.draw(gg_and_text)
```

<!--
http://www.sthda.com/english/wiki/wiki.php?id_contents=7930
-->


# Generate a poster 

## Title

```{r title_example, warning=FALSE}
txt_title_1 <- "This is a title."
txt_ITEM_1 <- "ITEM text is larger than item text."
txt_item_2 <- "This is a item text, too."
txt_BODY_1 <- "BODY text is larger than body text."
txt_body_2 <- "This is a body text, too."
arranged_txt <- arrange_txt(txt_title_1, txt_ITEM_1, txt_item_2, txt_BODY_1, txt_body_2)
grid::grid.draw(arranged_txt)
```

```{r}
  # t_1 <- "This is a sample text. "
  # t_2 <- "When longer than viewport width, "
  # t_3 <- "text will be split and add a break. "
  # t_4 <- "This text is separated into 5 objects, "
  # t_5 <- "because of R document specification."
  # text <- stringr::str_c(t_1, t_2, t_3, t_4, t_5)
  # splitText <- split_text_grob(text)
  # grid::grid.draw(splitText)
```

# Sample


```{r sample_two_colmns, warning=FALSE}
txt_title  <- "wameicheckr"
  # txt_subt   <- ""
txt_author <- "Toshikazu Matsumura (Konan Women's univ.)"
  # txt_affil  <- ""
  # txt_thank  <- ""
txt_kw     <- "keywords: analysis，databese, search species names"
```

```{r warning=FALSE}
txt_title     <- "title"
txt_author    <- "author"
txt_kw        <- "keywords"

tg_header <- arrange_txt(txt_title, txt_author, txt_kw)
grid::grid.draw(tg_header)
```

# References

- Code in『R graphics』 by Paul Murell
  - [1st edition]( https://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html )
  - [2nd edition]( https://www.stat.auckland.ac.nz/~paul/RG2e/ )
  - [3rd edition]( https://www.stat.auckland.ac.nz/~paul/RG3e/ )

<!--
  - https://stat-ata-asu.github.io/R_DS_BD2020/using-ggplot2.html
  - https://www.christophenicault.com/post/understand_size_dimension_ggplot2/

  - ggplot2, grid, gtable, gridExtra
    - https://notchained.hatenablog.com/entry/2015/12/17/010904
    - https://github.com/baptiste/gridextra/wiki/arranging-ggplot

  - gtable
    - https://cran.r-project.org/web/packages/gridExtra/vignettes/gtable.html
    - https://github.com/r-lib/gtable


# slide number function, but no need cf. grid:::grobAutoName

slide_no <- function(){
  res <- 
    grid::grid.ls(print=FALSE) %>%
    .$name
  if(length(res)==0) return(1)
  res <- 
    res %>%
    stringr::str_subset("slide") %>%
    stringr::str_split("\\.|_") %>%
    unlist() %>%
    stringr::str_subset("\\d")
  if(length(res)==0) return(1)
  return( max(as.numeric(res)) + 1)
}

-->
